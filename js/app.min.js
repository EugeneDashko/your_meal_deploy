(()=>{"use strict";const t=document.querySelector(".modal_product"),e=document.querySelector(".catalog__list"),o=document.querySelector(".modal-product__title"),n=document.querySelector(".modal-product__image"),c=document.querySelector(".modal-product__description"),d=document.querySelector(".ingredients__list"),r=document.querySelector(".ingredients__calories"),s=document.querySelector(".modal-product__price-count"),a=document.querySelector(".navigation__list"),i=document.querySelectorAll(".navigation__button"),l=document.querySelector(".catalog__title"),u=document.querySelector(".modal-product__btn"),_=document.querySelector(".modal_product .count__amount"),m=document.querySelector(".order__count"),p=document.querySelector(".order__list"),g=document.querySelector(".order__total-amount"),y=document.querySelector(".order"),v=document.querySelector(".order__wrap-title"),L=document.querySelector(".order__submit"),S=document.querySelector(".modal__delivery"),$=document.querySelector(".modal-delivery__form"),b="http://blue-juvenile-dime.glitch.me",q="/api/product",h=async t=>{const e=await fetch(t);if(e.ok)return e.json()},f=t=>{const e=document.createElement("li");return e.classList.add("catalog__item"),e.innerHTML=`\n      <article class="product" data-id-product=${t.id}>\n        <img class="product__image" src="${b}/${t.image}" alt="${t.title}">\n        <p class="product__price">${t.price}<span class="currency">₽</span></p>\n        <h3 class="product__title">\n            <button class="product_detail">${t.title}</button>\n        </h3>\n        <p class="product__weight">${t.weight}</p>\n        <button class="product__add" type="button">Добавить</button>\n      </article>\n    `,e},A=async(t="burger")=>{e.textContent="";const o=(await h(`${b}${q}?category=${t}`)).map(f);e.append(...o)},E=()=>{const t=localStorage.getItem("cart");return t?JSON.parse(t):[]},w=async()=>{const t=E();L.disabled=!t.length;const e=t.map((t=>t.id)),o=t.length?await h(`${b}${q}?list=${e}`):[],n=t.reduce(((t,e)=>t+e.count),0);m.textContent=n,p.textContent="";const c=o.map((e=>{const o=document.createElement("li");o.classList.add("order__item"),o.dataset.idProduct=e.id;const n=t.find((t=>t.id==e.id));return o.innerHTML=`\n            <img class="order__image" src="${b}/${e.image}" alt="${e.title}">\n            <div class="order__product">\n                <h3 class="order__product-title">${e.title}</h3>\n                <p class="order__product-weight">${e.weight}г</p>\n                <p class="order__product-price">${e.price}\n                    <span class="currency">₽</span>\n                </p>\n            </div>\n            <div class="order__product-count count">\n                <button class="count__minus" data-id-product=${n.id}>-</button>\n                <p class="count__amount">${n.count}</p>\n                <button class="count__plus" data-id-product=${n.id}>+</button>\n            </div>\n    `,o}));p.append(...c),g.textContent=o.reduce(((e,o)=>{const n=t.find((t=>t.id===o.id));return e+o.price*n.count}),0)},k=t=>{localStorage.setItem("cart",JSON.stringify(t)),w()},C=(t,e=1)=>{const o=E(),n=o.find((e=>e.id===t));n?n.count+=e:o.push({id:t,count:e}),k(o)};var x,I;x=function(t){1==t?document.querySelector("body").classList.add("webp"):document.querySelector("body").classList.add("no-webp")},(I=new Image).onload=I.onerror=function(){x(2===I.height)},I.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";const P=e=>{"Escape"==e.key&&(t.classList.remove("modal_open"),document.removeEventListener("keydown",P))};e.addEventListener("click",(e=>{const a=e.target;(a.closest(".product_detail")||a.closest(".product__image"))&&((async e=>{const a=await h(`${b}${q}/${e}`);o.textContent=a.title,n.src=`${b}/${a.image}`,d.textContent="";const i=a.ingredients.map((t=>{const e=document.createElement("li");return e.classList.add("ingredients__item"),e.textContent=t,e}));d.append(...i),c.textContent=a.description,r.textContent=`${a.weight}г ккал ${a.calories}`,s.textContent=a.price,u.dataset.idProduct=a.id,t.classList.add("modal_open")})(a.closest(".product").dataset.idProduct),document.addEventListener("keydown",P))})),t.addEventListener("click",(e=>{const o=e.target;(o.closest(".modal__close")||o===t)&&t.classList.remove("modal_open")})),A(),a.addEventListener("click",(t=>{const e=t.target.closest(".navigation__button");e&&i.forEach((t=>{t===e?(t.classList.add("navigation__button_active"),l.textContent=t.textContent,A(t.dataset.category)):t.classList.remove("navigation__button_active")}))})),e.addEventListener("click",(({target:t})=>{t.closest(".product__add")&&C(t.closest(".product").dataset.idProduct)})),u.addEventListener("click",(()=>{C(u.dataset.idProduct,parseInt(_.textContent))})),p.addEventListener("click",(({target:t})=>{const e=t.closest(".count__plus"),o=t.closest(".count__minus");e&&C(e.dataset.idProduct),o&&(t=>{const e=E(),o=e.findIndex((e=>e.id===t));e[o].count-=1,0===e[o].count&&e.splice(o,1),k(e)})(o.dataset.idProduct)})),v.addEventListener("click",(()=>{y.classList.toggle("order_open")})),L.addEventListener("click",(()=>{S.classList.add("modal_open")})),S.addEventListener("click",(({target:t})=>{(t.closest(".modal__close")||S===t)&&S.classList.remove("modal_open")})),w(),(t=>{$.addEventListener("change",(()=>{"pickup"===$.format.value&&$["address-info"].classList.add("modal-delivery__fieldset-input_hide"),"delivery"===$.format.value&&$["address-info"].classList.remove("modal-delivery__fieldset-input_hide")})),$.addEventListener("submit",(e=>{e.preventDefault();const o=new FormData($),n=Object.fromEntries(o);n.order=t(),console.log("data.order: ",n.order),fetch("https://reqres.in/api/users")}))})(E)})();
